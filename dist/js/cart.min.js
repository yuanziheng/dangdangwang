"use strict";$(function(){var p=$.cookie("token"),e="";$.ajax({type:"get",url:"http://47.104.244.134:8080/cartlist.do",data:{token:p},success:function(t){for(var a in t)e+='\n\t\t\t\t\t<div class="good" data-id="'+t[a].id+'">\n\t\t\t\t\t\t<input type="checkbox" class="checkbtn"/>\n\t\t\t\t\t\t<img src="'+t[a].goods.picurl+'"/>\n\t\t\t\t\t\t<a href="detail.html?id='+t[a].goods.id+'"><p class="name">'+t[a].goods.name+'</p></a>\n\t\t\t\t\t\t<span class="price">'+t[a].goods.price+'</span>\n\t\t\t\t\t\t<div class="numbox">\n\t\t\t\t\t\t\t<a href="#" class="numadd" data-id="'+t[a].id+'" data-gid="'+t[a].gid+'">+</a>\n\t\t\t\t\t\t\t<input type="text" value='+t[a].count+' class="num" data-id="'+t[a].id+'" data-gid="'+t[a].gid+'"/>\n\t\t\t\t\t\t\t<a href="#" class="numdel" data-id="'+t[a].id+'" data-gid="'+t[a].gid+'">-</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="allprice">'+t[a].count*t[a].goods.price+'</span>\n\t\t\t\t\t\t<span class="del" data-id="'+t[a].id+'" data-gid="'+t[a].gid+'">删除</span>\n\t\t\t\t\t</div>\n\t\t\t\t';$(".cartlist").append(e),$(".checkbtn").click(function(){$(".checkbtn:checked").length==$(".checkbtn").length?$("#checkAll").prop("checked",!0):$("#checkAll").prop("checked",!1),r()});var r=function(){for(var t=0,a=0,e=0;e<$(".checkbtn:checked").length;e++)$(".checkbtn:checked")&&(t+=Number($(".checkbtn:checked").eq(e).parent().find(".allprice").text()),a+=Number($(".checkbtn:checked").eq(e).parent().find(".num").val()),console.log(t,a));$(".zongjia").text("￥ "+t),$(".goodsnum").text(a)};0==$(".checkbtn:checked").length&&($(".zongjia").text("￥ 0"),$(".goodsnum").text("0")),$(".numadd,.numdel,.jiesuanbtn").click(function(t){t.preventDefault()}),$(".numadd").on("click",function(){var t=$(this).parent().find(".num").val(),a=$(this).attr("data-id"),e=$(this).attr("data-gid");t++,$(this).parent().find(".num").val(t);var n=t*$(this).parent().parent().find(".price").text()*1;$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:a,gid:e,num:1,token:p},success:function(t){console.log(t)}}),$(this).parent().parent().find(".allprice").text(n),r()}),$(".numdel").on("click",function(){var t=$(this).parent().find(".num").val(),a=$(this).attr("data-id"),e=$(this).attr("data-gid");--t<1?t=1:$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:a,gid:e,num:-1,token:p},success:function(){}}),$(this).parent().find(".num").val(t);var n=t*$(this).parent().parent().find(".price").text()*1;$(this).parent().parent().find(".allprice").text(n),r()}),$(".del").on("click",function(){var t=$(this).attr("data-id"),a=$(this).attr("data-gid");$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:t,gid:a,num:0,token:p},success:function(){}}),$(this).parent().remove(),r()}),$("#checkAll").click(function(){$("input:checked").length==$(".checkbtn").length?($("#checkAll").prop("checked",!1),$(".checkbtn").prop("checked",!1)):$("input[type='checkbox']").prop("checked",!0),r()}),$(".num").on("blur",function(){var i=$(this).attr("data-id"),t=$(this).attr("data-gid"),d=$(this).val(),a=$(this).parent().parent().find(".price").text(),s=d*a*1,o=$(this);console.log(i,t,d),$.ajax({type:"get",url:"http://47.104.244.134:8080/cartlist.do",data:{token:p},success:function(t){for(var a in console.log(t),t)if(i==t[a].id){var e=t[a].count,n=t[a].id,c=t[a].gid;console.log(d,e),e<=d?$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:n,gid:c,num:d-e,token:p},success:function(){}}):$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:n,gid:c,num:-(e-d),token:p},success:function(t){}}),$(o).parent().parent().find(".allprice").text(s),r()}}})})}})});